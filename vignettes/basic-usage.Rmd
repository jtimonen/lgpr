---
title: "Basic usage of the lgpr package"
author: "Juho Timonen"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Basic usage of the lgpr package}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#")
knitr::opts_chunk$set(dev = "png", dev.args = list(type = "cairo-png"))
```

This vignette demonstrates how to model a longitudinal data set and perform covariate selection using the `lgp` function of the `lgpr` package. In the example cases, the number of data points is small enough so that the experiments can be run in just a few seconds.

```{r load}
require("lgpr")
```

## Simulating data
Here we simulate data with 6 individuals. We simulate individual-specific and shared age effects, as well as a sex-specific age effect. Also a categorial 'location' covariate is simulated, but it has no effect.

```{r simulate}
set.seed(2333)
sim <- simulate_data(N            = 8,
                     t_data       = seq(16, 96, by = 16),
                     covariates   = c(    0,2), # covariate types (2 = categorical)
                     lengthscales = c(12,12,1,12), # true effect lengthscales
                     relevances   = c(0,1,1,1), # true covariate relevances
                     names        = c("diseaseAge", "sex"),
                     t_jitter     = 0.5,  # jitter in time points
                     snr          = 3)    # signal-to-noise ratio
```

```{r plot_sim, fig.width=6.6, fig.height=4.7}
plot_sim(sim)
```

```{r components, fig.width=6.6, fig.height=5}
plot_sim(sim, comp_idx = 2)
```

## Creating and fitting a model
``````{r fit}
formula <- y ~ zs(id)*gp(age) + gp(age) + zs(sex)*gp(age) + gp_vm(diseaseAge)
fit <- lgp(formula  = formula,
           data     = sim@data,
           iter     = 1200,
           chains   = 4,
           refresh  = 200)

show(fit@model)
```

## Visualizing inferred components and predictions
```{r vis, fig.width=6.6, fig.height=5}
plot_f(fit, comp_idx = 4)
```

