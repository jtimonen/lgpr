---
title: "Specifying priors in the lgpr package"
author: "Juho Timonen"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
#  pdf_document:
#    toc: true     
vignette: >
  %\VignetteIndexEntry{Specifying priors in the lgpr package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#"
)
```
  
```{r require}
require(lgpr)
```

## Default priors
  
All parameters that are sampled have default priors which can be replaced by user-supplied priors. In the simplest case, the `prior` argument for the `lgp` function can be ignored, in which case default priors are used (`prior = prior_default()`). The prior argument has to be a list with the following fields

```{r fields}
my_prior <- prior_default()
print(names(my_prior))
```

These fields themselves contain lists specifying prior distributions for different types of model parameters. If a custom prior is to be supplied, it is recommended that it is done by first creating the list using `prior_default`, and then editing its fields. For example, the prior for the magnitude parameter of the disease-related age component can be accessed and edited in the following way:
```{r access}
print(my_prior$alpha$diseaseAge)
my_prior$alpha$diseaseAge <- list(type = "normal", mu = 0, sigma = 1)
print(my_prior$alpha$diseaseAge)
```


## Prior distributions
The possible types of prior distributions that can be defined are
  
1. Uniform (`uniform`)
2. Normal (`normal`)
3. Student-t (`student-t`)
4. Gamma (`gamma`)
5. Inverse-Gamma (`inv-gamma`)
6. Log-normal (`log-normal`)
7. Beta (`beta`)
  
In addition, all kernel parameters like $\alpha, \ell, \sigma_n$ are constrained to be non-negative, so only the positive part of the defined prior will matter. The hyperparameters of the prior (for example the mean and standard deviation of the normal prior) can be given by the user.
  
### 1. Uniform distribution
There are no hyperparameters.
  
### 2. Normal distribution $N(\mu,\sigma)$
The normal prior has two hyperparameters, $\mu$ and $\sigma$. The first one defines the mean and second one defines the standard deviation of the distribution.
  
```{r, fig.show='hold', echo = FALSE, fig.width = 3.45, fig.height = 2.6}
t   <- seq(0,5,by=0.05)
MU  <- c(0,2)
SIG <- c(2,0.5)
for(k in 1:2){
  mu    <- MU[k]
  sigma <- SIG[k]
  y     <- dnorm(t,mu,sigma)
  graphics::plot(t,y,'l',xlab="x",ylab="p(x)", col="firebrick3", 
     cex.axis=0.6, cex.main = 0.8, bty ="l",
     main = bquote("N(" ~.(mu)~ ","~.(sigma)~")"))
}

```

### 3. Student-t$(\nu)$ distribution
In the Student-t distribution, the hyperparameter $\nu$ that defines the degrees of freedom. The case $\nu=1$ corresponds to the Cauchy-distribution and $\nu \rightarrow \infty$ to the normal distribution with $\mu=0$ and $\sigma=1$. 
  
```{r, fig.show='hold', echo = FALSE, fig.width = 3.45, fig.height = 2.6}
t   <- seq(0,3,by=0.01)
NU  <- c(1,40)
for(k in 1:2){
  nu    <- NU[k]
  y     <- dt(t,df=nu)
  graphics::plot(t,y,'l',xlab="x",ylab="p(x)", col="firebrick3", 
     cex.axis=0.6, cex.main = 0.8, bty ="l",
     main = bquote("Student-t("~.(nu)~")"))
}

```

### 4. Gamma$(\alpha,\beta)$-distribution
The gamma distribution has two hyperparameters, the shape parameter $\alpha$ and the rate parameter $\beta$. It has the property that Gamma$(1,\beta)$ is the exponential distribution with rate parameter $\beta$.
  
```{r, fig.show='hold', echo = FALSE, fig.width = 3.45, fig.height = 2.6}
t <- seq(0,5,by=0.01)
A <- c(1,5)
B <- c(3,3)
for(k in 1:2){
  alpha <- A[k]
  beta  <- B[k]
  y     <- dgamma(t,shape=alpha,rate=beta)
  graphics::plot(t,y,'l',xlab="x",ylab="p(x)", col="firebrick3", 
     cex.axis=0.6, cex.main = 0.8, bty ="l",
     main = bquote("Gamma(" ~.(alpha)~ ","~.(beta)~")"))
}
```

### 5. Inv-Gamma$(\alpha,\beta)$ distribution
The inverse-gamma distribution also has the hyperparameters $\alpha$ and $\beta$. Its mode is at $\frac{\beta}{\alpha+1}$. Using an alternative parametrization, it is also called the scaled inverse $\chi^2$-distribution. The connection is
$$
\text{Scaled-inv-}\chi^2(\nu,\tau^2) = \text{Inv-Gamma} \left(\frac{\nu}{2}, \frac{\nu \tau^2}{2} \right)
$$
  
```{r, fig.show='hold', echo = FALSE, fig.width = 3.45, fig.height = 2.6}
#t <- seq(0,5,by=0.01)
#A <- c(3,3)
#B <- c(3,5)
#for(k in 1:2){
#  alpha <- A[k]
#  beta  <- B[k]
#  y     <- invgamma::dinvgamma(t,shape=alpha,rate=beta)
#  graphics::plot(t,y,'l',xlab="x",ylab="p(x)", col="firebrick3", 
#     cex.axis=0.6, cex.main = 0.8, bty ="l",
#     main = bquote("Inv-Gamma(" ~.(alpha)~ ","~.(beta)~")"))
#}
```

### 6. Log-Normal$(\mu,\sigma)$ distribution
The log-normal distribution is defined so that
$$
\theta \sim \text{LogNormal}(\mu,\sigma)  \hspace{1cm} \Longrightarrow \hspace{1cm}  \log(\theta) \sim N(\mu,\sigma) 
$$
  
```{r, fig.show='hold', echo = FALSE, fig.width = 3.45, fig.height = 2.6}
t <- seq(0,5,by=0.01)
M <- c(0,0)
S <- c(1,0.25)
for(k in 1:2){
  mlog  <- M[k]
  slog  <- S[k]
  y     <- stats::dlnorm(t,meanlog=mlog, sdlog=slog)
  graphics::plot(t,y,'l',xlab="x",ylab="p(x)", col="firebrick3", 
     cex.axis=0.6, cex.main = 0.8, bty ="l",
     main = bquote("Log-Normal(" ~.(mlog)~ ","~.(slog)~")"))
}
```

### 7. Beta$(\alpha,\beta)$ distribution
The support of the beta distribution is $[0,1]$ and it can be used to represent various distributions on this interval.
  
```{r, fig.show='hold', echo = FALSE, fig.width = 3.45, fig.height = 2.6}
graphics::par(mar=2*c(2,2,1,1))
YMAX <- c(3,3)
LL <- c("topleft", "top")
for(idx in c(1:2)){
  if(idx==1){
    A <- c(4,4,4)
    B <- c(1,2,4)
  }else{
    A <- 0.1*c(5,1)
    B <- 0.1*c(5,1)
  }
  t  <- seq(0, 1, by = 0.001)
  Y  <- matrix(0, length(t), length(A))
  cols <- c("#E41A1C", "#377EB8", "#4DAF4A")
  graphics::plot(c(0,1), c(0,YMAX[idx]), xlab = "x", ylab = "p(x)", col = "white",
                                  cex.axis=0.6, cex.main = 0.8, bty ="l")
  for(j in 1:length(A)){
    y <- dbeta(t, shape1 = A[j], shape2 = B[j])
    graphics::lines(t, y, col = cols[j], lwd = 2) 
  }
  LEG <- paste("Beta(", A, ", ", B, ")", sep = "")
  graphics::legend(LL[idx], legend = LEG, inset = 0.05, 
                 box.col = "black", lty = 1, col = cols, lwd = 2,
                 cex = 0.7)
}
```
