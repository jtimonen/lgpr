---
title: "Design of the lgpr software"
author: "Juho Timonen"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
#  pdf_document:
#    toc: true     
vignette: >
  %\VignetteIndexEntry{Design of the lgpr software}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#"
)
```

```{r load}
require("lgpr")
set.seed(123)
```

```{r plot_opts}
# Define plot options
color1 <- lgpr::color_set('blue')
LWD <- 2
plotBox <- function(x, y, s, col){
  a <- 0.45
  b <- 0.3
  X <- c(x-a, x+a, x+a, x-a)
  Y <- c(y+b, y+b, y-b, y-b)
  polygon(X, Y, col=col, border=NA)
  text(x, y, s, col='white', font=2)
}
```

## Overview
Interface: R -> Stan -> R

## Model

```{r image, fig.width = 7.2, fig.height=2.5, echo=FALSE}
par(mar=c(1.25,1.25,1.25,1.25))
plot(0, 0, pch=0, xlim=c(0.7,5.3), ylim=c(-1.3,1.3), bty='n', 
     yaxt='n', xaxt='n', ann=FALSE, main='Overview of the design')
x  <- c(1,2,3,4,5)
y1 <- c(0,1,1,1,1)
y2 <- c(0,-1)
lines(x, y1, col=color1, lwd=LWD)
lines(x[1:2], y2, col=color1, lwd=LWD)
plotBox(1, 0, 'Model', col=color1)
plotBox(2, -1, 'Likelihood', col=color1)
plotBox(2, 1, 'Function', col=color1)
plotBox(3, 1, 'Component', col=color1)
plotBox(4, 1, 'Kernel', col=color1)
plotBox(5, 1, 'Covariate', col=color1)

```

There are $D$ additive components so that
\begin{equation}
f(\textbf{x}) = f_1(\textbf{x}) + \ldots + f_D(\textbf{x})
\end{equation}
and one component is the basic model unit.

### Component
For each component $f_j(\textbf{x})$, one has to select the kernel. One kernel can be composed of other kernels
or be a base kernel. For each base kernel, one has to define its covariates.

### Base kernels

- Exponentiated quadratic
- Zero-sum
- Categorical
- Binary mask
- Nonstationary (input warp)
- Heterogeneous

