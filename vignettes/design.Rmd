---
title: "Design of the lgpr software"
author: "Juho Timonen"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
#  pdf_document:
#    toc: true     
vignette: >
  %\VignetteIndexEntry{Design of the lgpr software}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{css, echo=FALSE}
a { color: #098ee6; }
a:hover { color: #56b5f5; }
body { font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif; }
```

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#"
)
```

```{r load}
require("lgpr")
set.seed(123)
```

```{r plot_opts, echo=FALSE}
# Define plot options
color1 <- lgpr::color_set('blue')
LWD <- 2
plotBox <- function(x, y, s, col){
  a <- 0.45
  b <- 0.3
  X <- c(x-a, x+a, x+a, x-a)
  Y <- c(y+b, y+b, y-b, y-b)
  polygon(X, Y, col=col, border=NA)
  text(x, y, s, col='white', font=2)
}
```

## Overview
Interface: R -> Stan -> R

## Model

```{r image, fig.width = 7, fig.height=6, echo=FALSE}

# Create plot
par(mar=c(1.25,1.25,1.25,1.25))
plot(0, 0, pch=0, xlim=c(-2.5,1.5), ylim=c(-5,0.5), bty='n', 
     yaxt='n', xaxt='n', ann=FALSE, main='Overview of the design')

# Define box locations
x  <- c(0, 1, -1,
        -2, -1, 0,
        -2, -1, 0,
        -2, -1, 0)
y  <- c(0, -1, -1,
        -2, -2, -2,
        -3, -3, -3,
        -4, -4, -4)

# Define box labels
labels <- c("Model", "Obs. model", "Signal", 
            "Component 1", "Component 2", "Component 3",
            "Kernel 1", "Kernel 2", "Kernel 3",
            "Covariate 1", "Covariate 2", "Covariate 3")

# Define which boxes are connected with a line
line_starts <- c(1,1,3,3,3)
line_ends <- c(2,3,4,5,6)
L <- length(line_starts)

# Draw lines
for(i in seq_len(L)){
  i1 <- line_starts[i]
  i2 <- line_ends[i]
  lines(x[c(i1,i2)], y[c(i1,i2)], col=color1, lwd=LWD)
}

# Draw boxes
N <- length(labels)
for(i in seq_len(N)){
  plotBox(x[i], y[i], labels[i], col=color1)
}

```

There are $D$ additive components so that
\begin{equation}
f(\textbf{x}) = f_1(\textbf{x}) + \ldots + f_D(\textbf{x})
\end{equation}
and one component is the basic model unit.

### Component
For each component $f_j(\textbf{x})$, one has to select the kernel. One kernel can be composed of other kernels
or be a base kernel. For each base kernel, one has to define its covariates.

### Base kernels

- Exponentiated quadratic
- Zero-sum
- Categorical
- Binary mask
- Nonstationary (input warp)
- Heterogeneous

