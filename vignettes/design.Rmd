---
title: "Design of the lgpr software"
author: "Juho Timonen"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
#  pdf_document:
#    toc: true     
vignette: >
  %\VignetteIndexEntry{Design of the lgpr software}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
  
```{css, echo=FALSE}
a { color: #098ee6; }
a:hover { color: #56b5f5; }
body { font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif; }
```
  
```{r setup, include = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#"
)
```

```{r load, message=FALSE}
require("lgpr")
```

```{r plot_opts, echo=FALSE}
# Define plot options
color1 <- lgpr::colorset('blue')
LWD <- 2

plotBox <- function(x, y, s, col){
  a <- 0.45
  b <- 0.3
  X <- c(x-a, x+a, x+a, x-a)
  Y <- c(y+b, y+b, y-b, y-b)
  polygon(X, Y, col=col, border=NA)
  text(x, y, s, col='white', font=2)
}

plotGraph <- function(x, y, line_starts, line_ends, color, LWD, labels){
  
  # Draw lines
  L <- length(line_starts)
  for(i in seq_len(L)){
    i1 <- line_starts[i]
    i2 <- line_ends[i]
    lines(x[c(i1,i2)], y[c(i1,i2)], col=color, lwd=LWD)
  }
  
  # Draw boxes
  N <- length(labels)
  for(i in seq_len(N)){
    plotBox(x[i], y[i], labels[i], col=color)
  }
}
```

## Overview
Interface: R -> Stan -> R

## Model

A model consists of the observation model and the model for the signal. The 
signal $f(\textbf{x})$ consists of $D$ additive components so that
\begin{equation}
f(\textbf{x}) = f_1(\textbf{x}) + \ldots + f_D(\textbf{x})
\end{equation}
and each component $f_j(\textbf{x})$ is associated with a kernel.

```{r graph1, fig.width = 7, fig.height=4, echo=FALSE}

# Create plot
par(mar=c(1.25,1.25,1.25,1.25))
plot(0, 0, pch=0, xlim=c(-2.5,1.5), ylim=c(-3.5,0.5), bty='n', 
     yaxt='n', xaxt='n', ann=FALSE, main='Overview of the design')

# Define box locations
x  <- c(0,   1, -1,
        -2, -1, 0,
        -2, -1, 0)
y  <- c(0, -1, -1,
        -2, -2, -2,
        -3, -3, -3)

# Define box labels
labels <- c("Model", "Obs. model", "Signal", 
            "Component", "Component", "Component",
            "Kernel", "Kernel", "Kernel")

# Define which boxes are connected with a line
line_starts <- c(1,1,3,3,3, 4, 5, 6, 7, 7, 8, 9)
line_ends <- c(2,3,4,5,6, 7, 8, 9, 10, 11, 12, 13)

# Plot the graph
plotGraph(x, y, line_starts, line_ends, color1, LWD, labels)
```

A kernel can be composed of other kernels or be a base kernel. 
Each base kernel on only one covariate.

```{r graph2, fig.width = 7.2, fig.height=3, echo=FALSE}

# Create plot
par(mar=c(1.25,1.25,1.25,1.25))
plot(0, 0, pch=0, xlim=c(-2,2), ylim=c(-2.5,0.5), bty='n', 
     yaxt='n', xaxt='n', ann=FALSE, main='Overview of the design')

# Define box locations
x  <- c(0, -1, 1, -1, 1)
y  <- c(0, -1, -1, -2, -2)

# Define box labels
labels <- c("Kernel",
            "Base kernel", "Base kernel",
            "Covariate", "Covariate")

# Define which boxes are connected with a line
line_starts <- c(1,1,2,3)
line_ends <- c(2,3,4,5)

# Plot the graph
plotGraph(x, y, line_starts, line_ends, color1, LWD, labels)
```


