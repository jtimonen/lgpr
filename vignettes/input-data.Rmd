---
title: "Creating and modifying your input data frame for lgpr"
author: "Juho Timonen"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Creating and modifying your input data frame for lgpr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{css, echo=FALSE}
a:hover { color: #4ca5ff; }
a { color: #0065cc; }
body { font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif; }
```

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#")
```

```{r load, message=FALSE}
set.seed(123)
require("lgpr")
```

## ID and time variables
The main function of the `lgpr` package is called `lgp`, and it takes a model formula and data frame as input. The data is passed in the so called wide format, meaning that one row corresponds to one data point and there will be one column for each covariate. An example of a valid data frame could be created as below. 

```{r ex1}
id   <- as.factor(rep(1:4, each = 5))
age  <- rep(c(12,24,36,48,60), times = 4)
data <- data.frame(id, age)
```

Below we show the resulting data frame (transposed so that it will fit in smaller space here). It has four individuals, each measured at the same five time points. However, the time points need not be equal for all individuals, and the number of measurements can differ between individuals.

```{r table1, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
knitr::kable(t(data), digits = 2)
```

## Adding categorical covariates easily
Suppose that we want to add a categorical covariate `sex` to the above data frame. Sometimes you might have this information stored in a table like this:

```{r table2, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
sex <- c('Male', 'Female', 'Female', 'Male')
id <- c(1,2,3,4)
sex_data <- data.frame(id, sex)
knitr::kable(t(sex_data))
```

The `add_categorical_covariates` function adds a categorical covariate based on a named vector, where the names indicate the individual ID.
```{r add1, fig.width=6.6, fig.height=4}
sex <- as.factor(c('Male', 'Female', 'Female', 'Male'))
names(sex) <- c(1, 2, 3, 4) # name the vector elements to indicate individual IDs
data <- add_categorical_covariate(data, sex)
```

```{r table3, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
knitr::kable(t(data))
```

## Creating the disease-related age covariate
For nonstationary disease effect modeling, the disease-related age needs to be one covariate, i.e. column of the data frame. It is common that the available consists only of the observed disease initiation times. For example in Type 1 diabetes, the initiation time can be the first time point when the islet autoantibodies appeared in the blood. For control individuals, the disease-related age is not defined. Here, individuals 1, 2, and 4 are cases, and individual 3 is a healthy control.

```{r table4, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
t_init <- c(24, 36, 24)
id <- c(1,2,4)
init_data <- data.frame(id, t_init)
knitr::kable(t(init_data))
```

The `add_diseaseAges` function computes the disease-related ages from the initiation times and returns a data frame with 'diseaseAge' as a new column. As we see, `diseaseAge` is set to `NaN` for the control individual.
```{r add2, fig.width=6.6, fig.height=4}
t_init <- c(12, 36, 24)
names(t_init) <- c(1, 2, 4) # name the vector elements to indicate individual IDs
data <- add_disease_ages(data, t_init)
```

```{r table5, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
knitr::kable(t(data))
```

## Other variables
Variables can be added also by normally modifying the data frame. Here, variable `y` could be a response variable of interest. Here it is randomly generated.

```{r addy, fig.width=6.6, fig.height=4}
y <- rep(rnorm(4), each = 5) + sin(seq(0, 24, length.out = 20))
data$y <- y
```

## Visualizing data
Dataframes that are valid inputs for `lgp` can be visualized using `plot_data`.
```{r plot1, fig.width=6.6, fig.height=4}
#plot_data(data, color_by = 'sex')
```

```{r plot2, fig.width=6.6, fig.height=4}
#plot_data(data, color_by = 'group')
```